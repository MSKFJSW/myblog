---
title: "有意性検定の考え方 ~ P値の誤解 ~"
date: 2021-03-09
categories:
- category
- subcategory
output:
  blogdown::html_page:
    toc: TRUE
    css: "/css/custom.css"
thumbnailImage: https://halmek.co.jp/media/uploads/d955e3084920b92b28718b1e115e3e231588732714.3905.jpg
thumbnailImagePosition: left
summary: 検定とP値についての考察。
---

　P値は医学系論文に関わらず、必ずといっていいほど目にする。しかし誤解が多いのもこの指標の問題点。例えば、「P値は帰無仮説が間違っている確率である」は典型的な誤解の一つ。自分が統計学を学んでいて、最初に挫折を経験したのは、この検定の考え方とP値の解釈。


## 有意性検定の流れ
　T検定などの有意性検定は以下の流れで行われる。  
　1. 帰無仮説の設定  
　2. 有意水準の設定（0.05が慣例）   
　3. 検定統計量を計算し、P値を計算  
　4. P値が有意水準以下であれば、帰無仮説を棄却し対立仮説（解析者の主張）を支持  
　ざっくりと説明すると、0.05の確率で生じる事象
　検定の結果の解釈を難しくしているのは、帰無仮説とP値の関係が分かりづらいことにある。
　
## P値の定義
結論から言うと、P値の定義は、
「①帰無仮説が正しい、②データに系統誤差が無い、という状況下で、帰無仮説が間違っている確率」を表す。     

　つまり2つの仮定が満たされていなければ、P値は確率として解釈することができない。

### 仮定1 帰無仮説が正しい
　まず帰無仮説が正しいという状況下を仮想的につくる。
　以下では母平均130、母分散10の正規分布に従う、1000個のデータを生成している。これは集団全体から1000人の対象者のランダムサンプリングに相当する。
　
```{r}
library(tidyverse)
set.seed(123)
N <- data.frame(N1=rnorm(1000, 130, 10))
ggplot(N,aes(x=N1))+geom_histogram()
```

　生成された疑似データから標準化を行う。
```{r}
N$z <- (N$N1-130)/10
true_t<- data.frame(x = seq(-4, 4, length = 100)) %>%
    mutate(density = dt(x, df = 98))
ggplot(N,aes(x=z, y=..density..))+
  geom_histogram(binwidth=0.2)+
  geom_line(data = true_t, aes(x=x, y=density), color='blue')

```


有意水準0.05　→　確率0.05以下の事象を起こり得ないものとする
Z検定　平均値の差÷標準誤差
検定統計量　検定するためのデータに変換（標準誤差で割って標準化）
帰無仮説が正しい　両側検定ではZ=±1.96付近で確率密度0.025と0.975
　= 偶然帰無仮説を棄却する確率が0.05（ほとんど稀な事象）
帰無仮説が間違っている　データの分布が歪む
　= 帰無仮説が偶然で説明がつかない頻度で棄却される
　　分布が右に歪めば、p値は0.05以下になりやすくなる
　　これは母平均が異なることに相当
　　P値はもはや確率ではない




### 仮定2 系統誤差(バイアス)が無い
　上記ではそもそも帰無仮説が間違っていて、それがPを確率として解釈不能にしていることを述べた。しかしこれ以外にも、実際の研究や調査を行う場合に大きな問題となるものがある。それは一般に系統誤差（バイアス）と呼ばれる。  
　系統誤差とは、偶然以外の要因によってデータの分布がある方向性をもって歪む現象を指す。実際の研究や調査では系統誤差が必ずデータに入り込んでいると考えるべき。系統誤差を生じる要因は以下の3つである。
　1. 対象者のサンプリング
　2. 測定・データの収集
　3. 疑似相関・交絡による見かけ上の差
　特にサンプリング段階と測定段階での系統誤差はデータを集める段階で生じるもので、集める前から対策をする必要がある。疑似相関・交絡はデータを集めたあとでも対処ができる。
　
　結局のところ、P値は完全な偶然性のみによって生じたモデル（正規分布やt分布）に基づいて計算されるものであり、偶然以外の要因が入り込めばもはや確率として解釈はできない。ここの理解が検定結果の解釈の要だと思う。

## P値の解釈
　ではP値をどのように解釈したら良いのか。疫学者のRothman先生は、「P値は得られたデータと帰無仮説の相対的一致性を示す指標」と言っている。P値が大きければ帰無仮説とデータはよく合致、低ければ矛盾があることを示す。一応P=0.05とP=0.001では後者の方が矛盾度合いが高いと判断できる。
　しかし帰無仮説とデータの矛盾が生じている原因が系統誤差にあるのであれば、いくらP値が低くても解釈には意味がない。研究者が恣意的にデータを集めれば、統計的に有意な結果が出るのは当然のこと。だからP値が小さくなった原因がある要因にあると主張するためにも、できる限り系統誤差が無いことを研究者は保証することが義務付けられることになる。
　検定やP値については、京大SPHの佐藤先生が論文で詳しくまとめられているのでそちらを参考に。
　
　
　
●参考資料

1. Rothman先生の疫学入門書。入門書と書いているが、内容は少し高度。
(ロスマンの疫学, Kenneth J. Rothman, 2013, 篠原出版新社)[https://www.amazon.co.jp/%E3%83%AD%E3%82%B9%E3%83%9E%E3%83%B3%E3%81%AE%E7%96%AB%E5%AD%A6%E2%80%95%E7%A7%91%E5%AD%A6%E7%9A%84%E6%80%9D%E8%80%83%E3%81%B8%E3%81%AE%E8%AA%98%E3%81%84-KennethJ-Rothman/dp/4884123727]

2. 京大SPHの佐藤先生の論文。非常にわかりやすくおすすめ。
(ASA声明と疫学研究におけるP値, 佐藤 俊哉, 2017年, 計量生物学)[https://www.jstage.jst.go.jp/article/jjb/38/2/38_109/_pdf]


