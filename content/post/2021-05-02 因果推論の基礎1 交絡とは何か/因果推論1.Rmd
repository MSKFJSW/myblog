---
title: "因果推論1 交絡による「相関≠因果」"
date: 2021-05-02
categories: 
- 因果推論
- 交絡
- R
summary: 「相関≠因果」は多くの統計学の本に書かれていますが、これは不正確な表現です。正しくは特定条件下で「相関=因果」となります。その特定条件とは何か、Rを動かしながら考えます。第1回目は交絡です。
output: 
  blogdown::html_page:
   toc: TRUE
   css: "/css/custom.css"
thumbnailImage: https://images-na.ssl-images-amazon.com/images/I/71DtqwUVqWL.jpg
thumbnailImagePosition: left
coverImage: https://www.jalan.net/news/img/2020/11/20201124_hoshizora_019.jpg
coverSize: partial
---
  「相関≠因果」は統計学本でよく目にします。これは正しいのですが、不正確な表現です。正確には、「**特定の条件下**で、相関=因果」が正しいです。ではその**特定の条件下**とは何か。それを扱うのが**因果推論**という統計学の分野です。  
　「相関≠因果」を生じさせる原因の一つが**交絡**と呼ばれる現象です。以下でデータを扱いながら考えましょう。  

# 「相関=因果」の状態

　まず「相関=因果」となっている状態をデータで表現してみます。Aが曝露(原因)、Yがアウトカム(結果)とします。
```{r}
set.seed(100)
d1 <- data.frame(A=rbinom(1000,1,0.5))
for(i in 1:1000){
  ifelse(d1[i,1]==1, d1[i,2] <- rbinom(1,1,0.7),d1[i,2] <- rbinom(1,1,0.3))
}
names(d1)[which(names(d1)=="V2")] <- "Y"

```

```{r warning=F,fig.width=1,fig.height=0.5}
library(dagitty)
g <- dagitty('dag{
A -> Y
}')　
coordinates(g) <- list(x=c(A=0,Y=1),y=c(A=0,Y=0))
plot(g)
```

　作成したデータでは、AはYに対して因果関係にあると言えます。以下の棒グラフでは、A=1とA=0でのYの分布（Y=1とY=0）を示していますが、AはYに対して因果関係があるので、A=1の方がY=1の割合は高くなっています。ちなみにAはYに対してリスク比2.3[2.0 - 2.6]、リスク差38.0%[32.2 - 43.7]のリスクを持っています（いずれも有意）。

```{r warning=F,message=F }
library(epiR)
library(epitools)
table(d1)
table1 <- xtabs(~Y+A, data=d1)
barplot(table1, legend=rownames(table1))
epi.2by2(table1)
```

# 「相関≠因果」の状態

　では先程とは別のデータを新たに作ります。
```{r}
d2 <- data.frame(L=rnorm(1000,45,15))
for(i in 1:1000){
  ifelse(d2[i,1]>60, d2[i,2] <- rbinom(1,1,0.8), d2[i,2] <- rbinom(1,1,0.3))
  ifelse(d2[i,1]>60, d2[i,3] <- rbinom(1,1,0.8), d2[i,3] <- rbinom(1,1,0.3))
}
names(d2)[which(names(d2)=="V2")] <- "A"
names(d2)[which(names(d2)=="V3")] <- "Y"
```

　実は今回作成したデータでは、AはYに対して因果関係を持っていません。なぜならAとYは、第3の変数Lによってデータが生成されたからです。
```{r warning=F,fig.width=2,fig.height=1}
library(dagitty)
g <- dagitty('dag{
L -> Y
L -> A
}')
coordinates(g) <- list(x=c(A=0,L=0.5,Y=1),y=c(A=0,L=1,Y=0))
plot(g)
```

　また先程と同様にリスク比とリスク差を計算してみます。
```{r warning=F,message=F }
library(epiR)
library(epitools)
table2 <- xtabs(~Y+A, data=d2)
barplot(table2, legend=rownames(table2))
epi.2by2(table2)

```

　上記の結果を見ると、AはYに対して因果関係に無いにも関わらず、ぞれぞれリスク比1.3[1.2 - 1.5]、リスク差15.3%[9.0 - 21.6]となっています。あたかもAがYに対して因果関係を持っているように見えます。これが**交絡**と呼ばれる現象です。  

# 交絡への対処方法

　もし仮に交絡がLによって生じていると判明している場合、実はいくつかの方法で対処できます。今回はMH（マンテルヘンツェル）の方法で調整リスク比、調整リスク差を計算します。  
　まずLを60未満と以上で層に分けます。  
```{r}
for(i in 1:1000){
  ifelse(d2[i,1]<60, d2[i,4] <- 1, d2[i,4] <- 0)
}
names(d2)[4] <- "L60"
```

　次に以下でMHリスク比、MHリスク差が計算できます。
```{r}
table3 <- xtabs(~Y+A+L60,data=d2)
epi.2by2(table3)
```
　上記の結果を見ると、MHリスク比は1.01、MHリスク差は0.54%となっています。つまりLによって生じていた交絡を統制し、純粋なAとYの関係を見ることができたことになります。この結果から、AはYに対して因果関係に無いと確認することができました。  

# 交絡の統制の難しさ
　上記では交絡因子（交絡を引き起こす因子）Lが事前に分かっていたので、MHリスク比とMHリスク差が計算できました。しかし実際の調査やリアルワールドデータ、ビッグデータには、交絡因子は無数に存在しています。加えて**交絡因子がすべて測定されているかもしくは既知であるかも私達には検証するすべがありません**。ここが交絡のやっかいなところで、**いくら交絡因子を列挙して統制しても、得られたAとYの関係が交絡によるものなのか、因果関係なのかが分からないのです。**研究・解析を行う人間がすべきなのは、既存の学問的知見や一般常識の観点から、交絡因子を列挙して統制することです。    
　しかし「相関≠因果」をもたらすのは交絡だけではありません。間違った変数の統制や測定で生じるバイアスも問題となります。次回はこれら系統誤差を取り上げていきたいと思います。
　

