---
title: "解析前のデータ処理"
date: 2021-01-07
categories:
- データチェック
thumbnailImage: https://data.ac-illust.com/data/thumbnails/25/2556a1a58cc0f65945561861eae8c2b0_w.jpeg
thumbnailImageposition: left
output: html_document
lang: ja
---

統計解析前のデータチェック・処理についてのまとめ。　


## エクセルデータの読み込み
readxlパッケージのread_excel関数が高速読み込みでおすすめ。
```{r}
library(readxl)
dt <- read_excel("heart.xls")
```

```{r echo=FALSE, message=FALSE}
library(tidyverse)
library(knitr)
library(kableExtra)
head(dt) %>% kable(caption = "Heart.xlsデータ") %>% kable_classic_2(full_width=F, html_font="san-serif", font_size=10)
```


## データの構造確認
変数名、変数の型、データ数をチェック
```{r}
str(dt)
```

## 要約統計量
```{r}
summary(dt)
```


## 変数ごとの集計
データ$変数名でいずれかの列の変数を指定
```{r message=FALSE}
library(tidyverse)
library(kableExtra)
p <- ggplot(dt, aes(x=AgeStart))+geom_histogram()+theme_bw()+labs(x="AgeStart 追跡開始時年齢", y="データ数")+stat_bin(bins=100)
p
table(dt$DeathCause) %>% knitr::kable() %>% kable_classic(full_width=F, html_font="san-serif")　
# %/%は左のオブジェクトを右の関数の第1引数に引き渡すパイプ演算子
# library(knitr)とknitr::は同じ意味
```


## 列の追加
dplyrパッケージのmutate関数を使用    
試しに開始年齢から平均値を引いた変数stdAgeを作成
```{r}
dt1 <- dplyr::mutate(dt, stdAge=AgeStart-mean(AgeStart))
head(dt1$stdAge) %>% kable(digits=2, aption = "stdAge") %>% kable_classic(full_width=F , html_font="san-serif")
```

```{r}
library(DiagrammeR)
graph <- "digraph{graph[fontoname=Meiryo, rankdir=LR] node[label='魚＋ステンレス'] A node[label='生臭くない']B node[label='魚']C node[label='生臭い']D A->B C->D}"
grViz(graph)
```




